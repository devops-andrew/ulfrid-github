{"componentChunkName":"component---src-templates-blog-post-js","path":"/python/Django-it/","result":{"data":{"site":{"siteMetadata":{"title":"Ulfrid_log","author":"[ulfrid]","siteUrl":"https://ulfrid.github.io","comment":{"disqusShortName":"ulfrid-github-io","utterances":""},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"b68849fe-92b2-5212-b07a-5f5b1c4afaf8","excerpt":"장고를 쓰다보니 점점 익숙해지는 한편 자주 쓰게 되는 것들이 있다. 오늘은 그것을 정리! 장고 ORM에 익숙해지려고 해도 아직은 경험 부족 및 많은 부분에서 자유롭지 않다. 정답이 있는 테이블을 보고 짜는데도, 원하는대로 결과를 얻지 못하기가 부지기수… 그리하여 내가 최근에 겪은 것들을 정리해보기로 했다. 1. 모델을 불러오는 다양한 방법 중 습관화 된 것. 위와 같은 오브젝트의 값을 불러올때 쿼리셋 형태가 되면 바로 호출하기 까다롭다.\n그래서 리스트안에 넣고, 바로 JsonResponse…","html":"<p><img src=\"https://onsil-thegreenhouse.github.io/assets/images//programming/django/python-django-logo.jpg\"></p>\n<h2 id=\"장고를-쓰다보니-점점-익숙해지는-한편-자주-쓰게-되는-것들이-있다\" style=\"position:relative;\"><a href=\"#%EC%9E%A5%EA%B3%A0%EB%A5%BC-%EC%93%B0%EB%8B%A4%EB%B3%B4%EB%8B%88-%EC%A0%90%EC%A0%90-%EC%9D%B5%EC%88%99%ED%95%B4%EC%A7%80%EB%8A%94-%ED%95%9C%ED%8E%B8-%EC%9E%90%EC%A3%BC-%EC%93%B0%EA%B2%8C-%EB%90%98%EB%8A%94-%EA%B2%83%EB%93%A4%EC%9D%B4-%EC%9E%88%EB%8B%A4\" aria-label=\"장고를 쓰다보니 점점 익숙해지는 한편 자주 쓰게 되는 것들이 있다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>장고를 쓰다보니 점점 익숙해지는 한편 자주 쓰게 되는 것들이 있다.</h2>\n<h1 id=\"오늘은-그것을-정리\" style=\"position:relative;\"><a href=\"#%EC%98%A4%EB%8A%98%EC%9D%80-%EA%B7%B8%EA%B2%83%EC%9D%84-%EC%A0%95%EB%A6%AC\" aria-label=\"오늘은 그것을 정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>오늘은 그것을 정리!</h1>\n<ul>\n<li>장고 ORM에 익숙해지려고 해도 아직은 경험 부족 및 많은 부분에서 자유롭지 않다.</li>\n<li>정답이 있는 테이블을 보고 짜는데도, 원하는대로 결과를 얻지 못하기가 부지기수…</li>\n<li>그리하여 내가 최근에 겪은 것들을 정리해보기로 했다.</li>\n</ul>\n<h3 id=\"1-모델을-불러오는-다양한-방법-중-습관화-된-것\" style=\"position:relative;\"><a href=\"#1-%EB%AA%A8%EB%8D%B8%EC%9D%84-%EB%B6%88%EB%9F%AC%EC%98%A4%EB%8A%94-%EB%8B%A4%EC%96%91%ED%95%9C-%EB%B0%A9%EB%B2%95-%EC%A4%91-%EC%8A%B5%EA%B4%80%ED%99%94-%EB%90%9C-%EA%B2%83\" aria-label=\"1 모델을 불러오는 다양한 방법 중 습관화 된 것 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 모델을 불러오는 다양한 방법 중 습관화 된 것.</h3>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Category</span><span class=\"token punctuation\">(</span>View<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n <span class=\"token number\">13</span>\n <span class=\"token number\">14</span>     <span class=\"token keyword\">def</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n <span class=\"token number\">15</span>         category_list <span class=\"token operator\">=</span> <span class=\"token builtin\">list</span><span class=\"token punctuation\">(</span>Categories<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n <span class=\"token number\">16</span>         <span class=\"token keyword\">return</span> JsonResponse<span class=\"token punctuation\">(</span>category_list<span class=\"token punctuation\">,</span> safe<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>위와 같은 오브젝트의 값을 불러올때 쿼리셋 형태가 되면 바로 호출하기 까다롭다.\n그래서 리스트안에 넣고, 바로 JsonResponse에 넘길때가 많다. safe=False 안해주면 에러다…</li>\n</ul>\n<h3 id=\"2-조인된-데이터-불러오기\" style=\"position:relative;\"><a href=\"#2-%EC%A1%B0%EC%9D%B8%EB%90%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%B6%88%EB%9F%AC%EC%98%A4%EA%B8%B0\" aria-label=\"2 조인된 데이터 불러오기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 조인된 데이터 불러오기.</h3>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token number\">31</span>\n<span class=\"token number\">32</span>     User<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">id</span><span class=\"token operator\">=</span>request<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span><span class=\"token builtin\">id</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>select_related<span class=\"token punctuation\">(</span><span class=\"token string\">'provider'</span><span class=\"token punctuation\">)</span>\n<span class=\"token number\">33</span>     User<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">id</span><span class=\"token operator\">=</span>request<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span><span class=\"token builtin\">id</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>prefetch_related<span class=\"token punctuation\">(</span><span class=\"token string\">'provider'</span><span class=\"token punctuation\">)</span>\n<span class=\"token number\">34</span></code></pre></div>\n<ul>\n<li>1대1, 1대다 관계에서 주로 사용하는 select_related</li>\n<li>다대다혹은 다대1 관계에 쓰는 prefetch_related 효율적으로 관계표현을 하고 쿼리 수행도 한다.</li>\n</ul>\n<h3 id=\"3-nested된-관계\" style=\"position:relative;\"><a href=\"#3-nested%EB%90%9C-%EA%B4%80%EA%B3%84\" aria-label=\"3 nested된 관계 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Nested된 관계.</h3>\n<ul>\n<li>이를 테면 기준 테이블에 포런키로 연결된 테이블의 포런키로 연결된 테이블이 있을경우.\n위의 프리패치나 셀렉트로는 예쁘게 데이터를 정렬해서 뽑기가 어렵다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token number\">33</span>     item_list <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n<span class=\"token number\">34</span>         <span class=\"token punctuation\">{</span>\n<span class=\"token number\">35</span>               <span class=\"token string\">'id'</span>      <span class=\"token punctuation\">:</span> item<span class=\"token punctuation\">[</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token number\">36</span>               <span class=\"token string\">'data'</span>    <span class=\"token punctuation\">:</span> item<span class=\"token punctuation\">[</span><span class=\"token string\">\"data\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token number\">37</span>               <span class=\"token string\">'answer'</span>  <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n<span class=\"token number\">38</span>                           <span class=\"token string\">'id'</span>     <span class=\"token punctuation\">:</span> answer<span class=\"token punctuation\">[</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token number\">39</span>                           <span class=\"token string\">'value'</span>  <span class=\"token punctuation\">:</span> answer<span class=\"token punctuation\">[</span><span class=\"token string\">\"value\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>\n<span class=\"token number\">40</span>                           <span class=\"token keyword\">for</span> answer <span class=\"token keyword\">in</span> Answer<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n<span class=\"token number\">41</span>          <span class=\"token punctuation\">}</span><span class=\"token keyword\">for</span> item <span class=\"token keyword\">in</span> Items<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n<span class=\"token number\">42</span>     <span class=\"token punctuation\">]</span></code></pre></div>\n<ul>\n<li>위와 같이 리스트 컴프리헨션을 사용해서 네스티드된관계에 따른 예쁜 데이터 모양을\n뿌려서 JsonResponse에 전달할수 있다! (오늘 터득해서 완전 신남!!!!)</li>\n</ul>\n<h3 id=\"4-트랜잭션을-활용하자\" style=\"position:relative;\"><a href=\"#4-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EC%9D%84-%ED%99%9C%EC%9A%A9%ED%95%98%EC%9E%90\" aria-label=\"4 트랜잭션을 활용하자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 트랜잭션을 활용하자.</h3>\n<ul>\n<li>업데이트를 한다던지, 가입시에 절차적으로 선행되는 작업이 있다던지 할때.\n트랜잭션에 담아두면, 해당 되는 작업 들이 모두 완료되지 않으면 롤백하는\n기능이 있다. 심지어 쉽다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"> <span class=\"token number\">41</span> <span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>db <span class=\"token keyword\">import</span> transaction\n <span class=\"token number\">42</span>\n <span class=\"token number\">43</span> <span class=\"token keyword\">def</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span>requset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n <span class=\"token number\">44</span>\n <span class=\"token number\">45</span>      <span class=\"token keyword\">with</span> transaction<span class=\"token punctuation\">.</span>atomic<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n <span class=\"token number\">46</span>           a<span class=\"token punctuation\">.</span>delete<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n <span class=\"token number\">47</span>\n <span class=\"token number\">48</span>           b<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n <span class=\"token number\">49</span>\n <span class=\"token number\">50</span></code></pre></div>\n<ul>\n<li>위와 같이 삭제하고 저장하는 경우, 삭제 작업이 제대로 이루어져야만 저장할수 있다.\n트랜잭션에 대한 자료는\n<a href=\"https://docs.djangoproject.com/en/2.2/topics/db/transactions/#tying-transactions-to-http-requests\">https://docs.djangoproject.com/en/2.2/topics/db/transactions/#tying-transactions-to-http-requests</a></li>\n</ul>\n<h3 id=\"5-httpie로-테스트하는-법\" style=\"position:relative;\"><a href=\"#5-httpie%EB%A1%9C-%ED%85%8C%EC%8A%A4%ED%8A%B8%ED%95%98%EB%8A%94-%EB%B2%95\" aria-label=\"5 httpie로 테스트하는 법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. httpie로 테스트하는 법</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">http -v localhost:8000/user/auth <span class=\"token assign-left variable\">email</span><span class=\"token operator\">=</span>test@test.net <span class=\"token assign-left variable\">password</span><span class=\"token operator\">=</span><span class=\"token number\">12345678</span>\n<span class=\"token comment\">#로그인 테스트</span>\nhttp -v localhost:8000/user/aaaa Access_token:<span class=\"token string\">\"1asde1jiop1230124<span class=\"token variable\">$#</span>21.....\"</span>\n<span class=\"token comment\">#인증 테스트</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'{\"title\":\"A\",\"user_id\":111,\"answer\":[{\"title\": \"BBB\", \"service_list\":\"1,2,3,4,5,6,7,8\"},{\"title\":\"CCC\",\"service_list\":\"2,4,6,8,7,10\"}]}'</span> <span class=\"token operator\">|</span> http -v localhost:8000/aaa/bbb/6 Access_token:<span class=\"token string\">\"eyJ0eXAiOiJKiJIUzI1NiJ9......\"</span>\n<span class=\"token comment\"># 글작성 테스트위한 Json 넘기기</span></code></pre></div>\n<ul>\n<li>다양한 테스트를 httpie로 해볼 수 있다.</li>\n</ul>","frontmatter":{"title":"장고 그놈 참...","date":"July 10, 2019"}}},"pageContext":{"slug":"/python/Django-it/","previous":{"fields":{"slug":"/python/Django-summary-01/"},"frontmatter":{"title":"Django 정리 하기 -first","category":"python"}},"next":{"fields":{"slug":"/python/coding-convention/"},"frontmatter":{"title":"코드 컨벤션의 중요성","category":"python"}}}},"staticQueryHashes":["3128451518","96099027"]}